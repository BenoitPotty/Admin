<KoenigCard
    @tagName="figure"
    @icon="ellexx/card-indicator-pers"
    @class="kg-card-hover"
    @isSelected={{this.isSelected}}
    @isEditing={{this.isEditing}}
    @selectCard={{action this.selectCard}}
    @deselectCard={{action this.deselectCard}}
    @editCard={{action this.editCard}}
    @saveAsSnippet={{this.saveAsSnippet}}
    @toolbar={{this.toolbar}}
    @hasEditMode={{false}}
    @addParagraphAfterCard={{this.addParagraphAfterCard}}
    @moveCursorToPrevSection={{this.moveCursorToPrevSection}}
    @moveCursorToNextSection={{this.moveCursorToNextSection}}
    @editor={{this.editor}}
    as |card|
>
    <div class="m4 pa4 ba">
        <h6>Person</h6>
        <p></p>
        <p></p>
        <div class="underline">Foto</div>
        <p></p>
        <p></p>
        <GhUploader
            @files={{this.files}}
            @accept={{this.imageMimeTypes}}
            @extensions={{this.imageExtensions}}
            @onStart={{action "setPreviewSrc"}}
            @onComplete={{action "updateSrc"}}
            @onFailed={{action "resetSrcs"}}
            as |uploader|
        >
            <div
                class="relative{{unless
                        (or this.previewSrc this.payload.src)
                        " bg-whitegrey-l2"
                    }}"
            >
                {{#if (or this.previewSrc this.payload.src)}}
                    <img
                        src={{or this.previewSrc this.payload.src}}
                        class="{{kg-style
                                this.kgImgStyle
                                sidebar=this.ui.hasSideNav
                            }}"
                        alt={{this.payload.alt}}
                    />
                    {{#if this.isDraggedOver}}
                        <div
                            class="absolute absolute--fill flex items-center bg-black-60 pe-none"
                        >
                            <span class="db center sans-serif fw7 f7 white">
                                Drop to replace foto
                            </span>
                        </div>
                    {{/if}}
                {{/if}}

                {{#if
                    (or
                        uploader.errors
                        uploader.isUploading
                        (not this.payload.src)
                    )
                }}
                    <div
                        class="relative miw-100 flex items-center
                            {{if
                                (not this.previewSrc this.payload.src)
                                "kg-media-placeholder ba b--whitegrey"
                                "absolute absolute--fill bg-white-50"
                            }}"
                    >
                        {{#if uploader.errors}}
                            <span
                                class="db absolute top-0 right-0 left-0 pl2 pr2 bg-red white sans-serif f7"
                            >
                                {{uploader.errors.firstObject.message}}
                            </span>
                        {{/if}}

                        {{#if this.isDraggedOver}}
                            <span
                                class="db center sans-serif fw7 f7 middarkgrey"
                            >
                                Drop it like it's hot ðŸ”¥
                            </span>
                        {{else if uploader.isUploading}}
                            {{uploader.progressBar}}
                        {{else if (not this.previewSrc this.payload.src)}}
                            <button
                                class="flex flex-column items-center center sans-serif fw4 f7 middarkgrey pa16 pt14 pb14 kg-image-button"
                                onclick={{action "triggerFileDialog"}}
                            >
                                {{svg-jar
                                    this.placeholder
                                    class="kg-placeholder-image"
                                }}
                                <span class="mt2 midgrey">Click to select a foto</span>
                            </button>
                        {{/if}}
                    </div>
                {{/if}}
            </div>

            <div style="display:none">
                <GhFileInput
                    @multiple={{false}}
                    @action={{uploader.setFiles}}
                    @accept={{this.imageMimeTypes}}
                />
            </div>
        </GhUploader>

        <p></p>
        <p></p>
        <div class="underline">Einzelheiten</div>
        <p></p>
        <div class="gh-list">
            <div class="gh-list-row">
                <div class="gh-list-cell">
                    Name :
                </div>
                <div class="gh-list-cell">
                    <input
                        type="text"
                        placeholder="Name"
                        class="miw-100 pa2 ba br2 b--lightgrey-d2 f7 form-text lh-title tracked-2 h10 mb2"
                        name="pers_name"
                        value={{this.payload.pers_name}}
                        {{on "input" this.updateField}}
                    />
                </div>
            </div>
            <div class="gh-list-row">
                <div class="gh-list-cell">
                    Beschreibung :
                </div>
                <div class="gh-list-cell">
                    <textarea
                        placeholder="Beschreibung"
                        class="miw-100 pa2 ba br2 b--lightgrey-d2 f7 form-text lh-title tracked-2 h10 mb2"
                        name="pers_description"
                        value={{this.payload.pers_description}}
                        {{on "input" this.updateField}}
                    ></textarea>
                </div>
            </div>
            {{#if (eq this.payload.type "video")}}
                <div class="gh-list-row">
                    <div class="gh-list-cell">
                        Video:
                    </div>
                    <div class="gh-list-cell">
                        <input
                            placeholder="Link"
                            type="text"
                            class="miw-100 pa2 ba br2 b--lightgrey-d2 f7 form-text lh-title tracked-2 h10 mb2"
                            name="tbi_video_link"
                            value={{this.payload.tbi_video_link}}
                            {{on "change" this.updateYoutubeLink}}
                        />
                        {{#if tbi_video_link_invalid}}
                            <div class="tr f-small red pb4">URL is nicht gÃ¼ltig</div>
                        {{/if}}
                    </div>
                </div>
            {{/if}}
        </div>
    </div>
</KoenigCard>

{{#if this.isEditingLink}}
    <KoenigLinkInput
        @source="direct"
        @href={{this.payload.href}}
        @linkRect={{this.linkRect}}
        @update={{action "updateHref"}}
        @cancel={{action "cancelEditLink"}}
    />
{{/if}}